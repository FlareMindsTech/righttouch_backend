{
  "info": {
    "_postman_id": "b3ff7d87-2b5d-4b8a-8dd9-8dfd1f5b0f11",
    "name": "RightTouch - Customer Flow (A to Z)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "End-to-end Customer flow for RightTouch: auth -> profile -> address -> browse category/service/product -> cart -> checkout -> bookings -> rating/report -> payment (after completion). Uses environment tokens/ids from RightTouch.postman_environment.json."
  },
  "item": [
    {
      "name": "00 - Setup (Pick ONE)",
      "item": [
        {
          "name": "DEV - Create Customer (sets tokenCustomer + customerProfileId)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-dev-secret", "value": "{{devSecret}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/dev/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "dev", "users"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"Customer\",\n  \"email\": \"{{devCustomerEmail}}\",\n  \"password\": \"{{testPassword}}\",\n  \"confirmPassword\": \"{{testPassword}}\",\n  \"profile\": {\n    \"mobileNumber\": \"{{customerMobile}}\",\n    \"firstName\": \"Customer\",\n    \"lastName\": \"One\",\n    \"profileComplete\": true\n  }\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "pm.environment.set('tokenCustomer', j?.result?.token || j?.token || '');",
                  "pm.environment.set('customerProfileId', j?.result?.profileId || '');",
                  "pm.test('tokenCustomer saved', () => pm.expect(pm.environment.get('tokenCustomer')).to.not.equal(''));"
                ]
              }
            }
          ]
        },
        {
          "name": "OTP - Signup + Send OTP",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": {
              "raw": "{{baseUrl}}/api/user/signup",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "signup"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mobileNumber\": \"{{customerMobile}}\",\n  \"role\": \"Customer\"\n}"
            }
          }
        },
        {
          "name": "OTP - Verify OTP",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": {
              "raw": "{{baseUrl}}/api/user/verify-otp",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "verify-otp"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mobileNumber\": \"{{customerMobile}}\",\n  \"role\": \"Customer\",\n  \"otp\": \"{{otpCustomer}}\"\n}"
            }
          }
        },
        {
          "name": "OTP - Set Password (saves tokenCustomer if returned)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": {
              "raw": "{{baseUrl}}/api/user/set-password",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "set-password"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mobileNumber\": \"{{customerMobile}}\",\n  \"role\": \"Customer\",\n  \"password\": \"{{testPassword}}\",\n  \"confirmPassword\": \"{{testPassword}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "if (j?.token) pm.environment.set('tokenCustomer', j.token);"
                ]
              }
            }
          ]
        },
        {
          "name": "Login (Customer) -> tokenCustomer",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": {
              "raw": "{{baseUrl}}/api/user/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "login"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mobileNumber\": \"{{customerMobile}}\",\n  \"password\": \"{{testPassword}}\",\n  \"role\": \"Customer\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "pm.environment.set('tokenCustomer', j?.token || '');",
                  "pm.test('tokenCustomer saved', () => pm.expect(pm.environment.get('tokenCustomer')).to.not.equal(''));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "01 - My Profile",
      "item": [
        {
          "name": "Get My Profile",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }],
            "url": {
              "raw": "{{baseUrl}}/api/user/me",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "me"]
            }
          }
        },
        {
          "name": "Update My Profile (PUT /me)",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/user/me",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "me"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Customer\",\n  \"lastName\": \"Updated\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "02 - Address",
      "item": [
        {
          "name": "Create Address -> addressId",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/addresses",
              "host": ["{{baseUrl}}"],
              "path": ["api", "addresses"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"label\": \"home\",\n  \"addressLine\": \"123 Main Street\",\n  \"city\": \"Chennai\",\n  \"state\": \"TN\",\n  \"pincode\": \"600001\",\n  \"latitude\": {{customerLat}},\n  \"longitude\": {{customerLng}},\n  \"isDefault\": true\n}"
            }
          }, 
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const id = j?.result?._id || j?._id;",
                  "if (id) pm.environment.set('addressId', id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Get My Addresses",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }],
            "url": {
              "raw": "{{baseUrl}}/api/addresses",
              "host": ["{{baseUrl}}"],
              "path": ["api", "addresses"]
            }
          }
        },
        {
          "name": "Set Default Address",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/addresses/default",
              "host": ["{{baseUrl}}"],
              "path": ["api", "addresses", "default"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"addressId\": \"{{addressId}}\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "03 - Browse (Category / Services / Products)",
      "item": [
        {
          "name": "Get All Categories (service)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/user/getAllcategory?categoryType=service",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "getAllcategory"],
              "query": [{ "key": "categoryType", "value": "service" }]
            }
          }
        },
        {
          "name": "Get All Services",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/user/getAllServices",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "getAllServices"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const arr = j?.result;",
                  "if (Array.isArray(arr) && arr[0]?._id) pm.environment.set('serviceId', arr[0]._id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Products",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/user/getProduct",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "getProduct"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const arr = j?.result;",
                  "if (Array.isArray(arr) && arr[0]?._id) pm.environment.set('productId', arr[0]._id);"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "04 - Cart",
      "item": [
        {
          "name": "Add Service to Cart",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/user/cart/add",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "cart", "add"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"itemType\": \"service\",\n  \"itemId\": \"{{serviceId}}\",\n  \"quantity\": 1\n}"
            }
          }
        },
        {
          "name": "Get My Cart -> cartId + cartItemId",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }],
            "url": {
              "raw": "{{baseUrl}}/api/user/cart/my-cart",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "cart", "my-cart"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const cart = j?.result || j;",
                  "if (cart?._id) pm.environment.set('cartId', cart._id);",
                  "const items = cart?.items || cart?.cartItems || [];",
                  "const first = Array.isArray(items) ? items[0] : null;",
                  "if (first?._id) pm.environment.set('cartItemId', first._id);"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "05 - Checkout (Creates Booking + Broadcast)",
      "item": [
        {
          "name": "Checkout -> bookingId",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/user/checkout",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "checkout"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"addressId\": \"{{addressId}}\",\n  \"paymentMode\": \"online\",\n  \"scheduledAt\": \"2026-01-15T10:00:00.000Z\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const booking = j?.result?.booking || j?.result?.serviceBooking || j?.result || j;",
                  "const bookingId = booking?._id || j?.result?.bookingId;",
                  "if (bookingId) pm.environment.set('bookingId', bookingId);",
                  "pm.test('bookingId saved', () => pm.expect(pm.environment.get('bookingId')).to.not.equal(''));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "06 - Bookings",
      "item": [
        {
          "name": "Get My Bookings",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }],
            "url": {
              "raw": "{{baseUrl}}/api/user/booking/getCustomerBookings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "booking", "getCustomerBookings"]
            }
          }
        },
        {
          "name": "Cancel Booking",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/user/booking/cancel/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "booking", "cancel", "{{bookingId}}"]
            },
            "body": { "mode": "raw", "raw": "{}" }
          }
        }
      ]
    },
    {
      "name": "07 - Rating & Report",
      "item": [
        {
          "name": "Create Rating -> ratingId",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/user/rating",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "rating"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"bookingId\": \"{{bookingId}}\",\n  \"bookingType\": \"service\",\n  \"serviceId\": \"{{serviceId}}\",\n  \"technicianId\": \"{{technicianProfileId}}\",\n  \"rates\": 5,\n  \"comment\": \"Great service\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const id = j?.result?._id || j?._id;",
                  "if (id) pm.environment.set('ratingId', id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Create Report -> reportId",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/user/report",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "report"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"bookingId\": \"{{bookingId}}\",\n  \"bookingType\": \"service\",\n  \"serviceId\": \"{{serviceId}}\",\n  \"technicianId\": \"{{technicianProfileId}}\",\n  \"complaint\": \"Technician delayed\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const id = j?.result?._id || j?._id;",
                  "if (id) pm.environment.set('reportId', id);"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "08 - Payment (After Job Completed)",
      "item": [
        {
          "name": "Create Payment (booking must be completed) -> paymentId",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenCustomer}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/user/payment",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user", "payment"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"bookingId\": \"{{bookingId}}\",\n  \"baseAmount\": 499\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const id = j?.result?._id || j?._id;",
                  "if (id) pm.environment.set('paymentId', id);"
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}
