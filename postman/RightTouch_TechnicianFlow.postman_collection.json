{
  "info": {
    "_postman_id": "1e5e4a12-4b7b-4f68-9dc1-9d663c86bba1",
    "name": "RightTouch - Technician Flow (A to Z)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "End-to-end Technician flow: auth -> complete profile -> skills -> KYC submit/upload -> wait owner approval -> go online -> see broadcasts -> accept job -> update status -> view wallet history. Uses environment tokens/ids from RightTouch.postman_environment.json."
  },
  "item": [
    {
      "name": "00 - Setup (Pick ONE)",
      "item": [
        {
          "name": "DEV - Create Technician (sets tokenTechnician + technicianProfileId)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-dev-secret", "value": "{{devSecret}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/dev/users", "host": ["{{baseUrl}}"], "path": ["api", "dev", "users"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"Technician\",\n  \"email\": \"{{devTechnicianEmail}}\",\n  \"password\": \"{{testPassword}}\",\n  \"confirmPassword\": \"{{testPassword}}\",\n  \"profile\": {\n    \"mobileNumber\": \"{{technicianMobile}}\",\n    \"firstName\": \"Tech\",\n    \"lastName\": \"One\",\n    \"profileComplete\": false,\n    \"workStatus\": \"pending\",\n    \"availability\": { \"isOnline\": false }\n  }\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "pm.environment.set('tokenTechnician', j?.result?.token || j?.token || '');",
                  "pm.environment.set('technicianProfileId', j?.result?.profileId || '');",
                  "pm.test('tokenTechnician saved', () => pm.expect(pm.environment.get('tokenTechnician')).to.not.equal(''));"
                ]
              }
            }
          ]
        },
        {
          "name": "Login (Technician) -> tokenTechnician",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{baseUrl}}/api/user/login", "host": ["{{baseUrl}}"], "path": ["api", "user", "login"] },
            "body": { "mode": "raw", "raw": "{\n  \"mobileNumber\": \"{{technicianMobile}}\",\n  \"password\": \"{{testPassword}}\",\n  \"role\": \"Technician\"\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "pm.environment.set('tokenTechnician', j?.token || '');",
                  "pm.test('tokenTechnician saved', () => pm.expect(pm.environment.get('tokenTechnician')).to.not.equal(''));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "01 - My Profile",
      "item": [
        {
          "name": "Get My Profile",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }],
            "url": { "raw": "{{baseUrl}}/api/user/me", "host": ["{{baseUrl}}"], "path": ["api", "user", "me"] }
          }
        },
        {
          "name": "Complete Profile (Technician)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/user/complete-profile", "host": ["{{baseUrl}}"], "path": ["api", "user", "complete-profile"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Tech\",\n  \"lastName\": \"One\",\n  \"gender\": \"Male\",\n  \"mobileNumber\": \"{{technicianMobile}}\",\n  \"address\": \"12 Street\",\n  \"city\": \"Chennai\",\n  \"state\": \"TN\",\n  \"pincode\": \"600001\",\n  \"latitude\": {{technicianLat}},\n  \"longitude\": {{technicianLng}},\n  \"locality\": \"T Nagar\",\n  \"experienceYears\": 2,\n  \"specialization\": \"AC\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "02 - Skills & Online",
      "item": [
        {
          "name": "Update Skills (Technician)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/technician/technicianData", "host": ["{{baseUrl}}"], "path": ["api", "technician", "technicianData"] },
            "body": { "mode": "raw", "raw": "{\n  \"skills\": [{ \"serviceId\": \"{{serviceId}}\" }]\n}" }
          }
        },
        {
          "name": "Go Online (availability.isOnline=true)",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/technician/updateTechnician/{{technicianProfileId}}", "host": ["{{baseUrl}}"], "path": ["api", "technician", "updateTechnician", "{{technicianProfileId}}"] },
            "body": { "mode": "raw", "raw": "{\n  \"availability\": { \"isOnline\": true }\n}" }
          }
        }
      ]
    },
    {
      "name": "03 - KYC",
      "item": [
        {
          "name": "Submit KYC -> technicianKycId",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/technician/technician/kyc", "host": ["{{baseUrl}}"], "path": ["api", "technician", "technician", "kyc"] },
            "body": { "mode": "raw", "raw": "{\n  \"aadhaarNumber\": \"123412341234\",\n  \"panNumber\": \"ABCDE1234F\",\n  \"drivingLicenseNumber\": \"TN0120060000000\"\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const id = j?.result?._id || j?._id;",
                  "if (id) pm.environment.set('technicianKycId', id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Upload KYC Documents (form-data)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }],
            "url": { "raw": "{{baseUrl}}/api/technician/technician/kyc/upload", "host": ["{{baseUrl}}"], "path": ["api", "technician", "technician", "kyc", "upload"] },
            "body": {
              "mode": "formdata",
              "formdata": [
                { "key": "aadhaarImage", "type": "file", "src": "" },
                { "key": "panImage", "type": "file", "src": "" },
                { "key": "dlImage", "type": "file", "src": "" }
              ]
            }
          }
        },
        {
          "name": "Get My KYC",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }],
            "url": { "raw": "{{baseUrl}}/api/technician/technician/kyc/me", "host": ["{{baseUrl}}"], "path": ["api", "technician", "technician", "kyc", "me"] }
          }
        }
      ]
    },
    {
      "name": "04 - Jobs (Broadcast -> Accept -> Status)",
      "item": [
        {
          "name": "My Broadcast Jobs -> jobBroadcastId + bookingId",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }],
            "url": { "raw": "{{baseUrl}}/api/technician/job-broadcast/my-jobs", "host": ["{{baseUrl}}"], "path": ["api", "technician", "job-broadcast", "my-jobs"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const j = pm.response.json();",
                  "const first = Array.isArray(j?.result) ? j.result[0] : null;",
                  "if (first?._id) pm.environment.set('jobBroadcastId', first._id);",
                  "if (first?.bookingId?._id) pm.environment.set('bookingId', first.bookingId._id);",
                  "pm.test('jobBroadcastId saved', () => pm.expect(pm.environment.get('jobBroadcastId')).to.not.equal(''));"
                ]
              }
            }
          ]
        },
        {
          "name": "Accept Job",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/technician/job-broadcast/respond/{{jobBroadcastId}}", "host": ["{{baseUrl}}"], "path": ["api", "technician", "job-broadcast", "respond", "{{jobBroadcastId}}"] },
            "body": { "mode": "raw", "raw": "{\n  \"status\": \"accepted\"\n}" }
          }
        },
        {
          "name": "Update Booking Status (on_the_way)",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/technician/status/{{bookingId}}", "host": ["{{baseUrl}}"], "path": ["api", "technician", "status", "{{bookingId}}"] },
            "body": { "mode": "raw", "raw": "{\n  \"status\": \"on_the_way\"\n}" }
          }
        },
        {
          "name": "Update Booking Status (completed)",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/technician/status/{{bookingId}}", "host": ["{{baseUrl}}"], "path": ["api", "technician", "status", "{{bookingId}}"] },
            "body": { "mode": "raw", "raw": "{\n  \"status\": \"completed\"\n}" }
          }
        },
        {
          "name": "Current Jobs",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }],
            "url": { "raw": "{{baseUrl}}/api/technician/jobs/current", "host": ["{{baseUrl}}"], "path": ["api", "technician", "jobs", "current"] }
          }
        },
        {
          "name": "Job History",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }],
            "url": { "raw": "{{baseUrl}}/api/technician/jobs/history", "host": ["{{baseUrl}}"], "path": ["api", "technician", "jobs", "history"] }
          }
        }
      ]
    },
    {
      "name": "05 - Wallet",
      "item": [
        {
          "name": "Wallet History (Technician)",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenTechnician}}" }],
            "url": { "raw": "{{baseUrl}}/api/technician/wallet/history", "host": ["{{baseUrl}}"], "path": ["api", "technician", "wallet", "history"] }
          }
        }
      ]
    }
  ]
}
